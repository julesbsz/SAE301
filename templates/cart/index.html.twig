{% extends 'base.html.twig' %}

{% block title %}Panier{% endblock %}

{% block body %}
    <header>
        <span><a href="/">Accueil</a> / Mon Panier</span>
        <h1>Mon panier</h1>
    </header>

    <section class="cart">
        <div class="cart-content">

        </div>

        <div class="cart-checkout">

        </div>
    </section>

    <script defer>
        let cookies = recupCookie("cart");

        if(cookies != null) {
            cookies = JSON.parse(cookies);
        } else {
            cookies = [];
        }

        console.log(cookies);

        let cart = 0;
        cookies.forEach(function(event) {
            cart += event.quantity;
        });

        function recupCookie(cart){
            if (document.cookie.length == 0) {
                return null;
            }

            let cookies = document.cookie.split("; ");
            cookies.forEach(element => {
                let item = element.split("=");
                if(item[0] === cart) {
                    output = item[1]
                } else {
                    output = null;
                }
            })
            return output;
        }

        cookies.forEach(item => {
            if(item.price == 0) {
                item.price = "Gratuit";
            } else {
                item.price = item.price + "â‚¬";
            }

            if(item.quantity == 1) {
                item.quantity = item.quantity + " place";
            } else {
                item.quantity = item.quantity + " places";
            }

            let html = `
                <article class="event" id="${item.id}">
                    <img src='build/${item.picture}' alt=${item.name}>
                    <div>
                        <h2>${item.name}</h2>
                        <span>${item.date}</span>
                        <span>${item.place}</span>
                        <p class="price">${item.price}</p>
                        <div class="action">
                            <i id="add" class="fa-solid fa-plus"></i>
                            <p id="quantity">${item.quantity}</p>
                            <i id="del" class="fa-solid fa-minus"></i>
                        </div>
                    </div>

                    <i id="del" class="fa-solid fa-trash-can del"></i>
                </article>
<!--                <hr>-->
            `;
            document.querySelector(".cart-content").innerHTML += html;
        })

        const del = document.querySelectorAll(".del");
        del.forEach(element => {
            element.addEventListener("click", function () {
                let id = element.parentElement.id;
                console.log(id);
                cookies.forEach(function(event, index) {
                    if(event.id == id) {
                        cookies.splice(index, 1);
                        console.log(cookies);

                        element.parentElement.remove();
                        cart -= element.quantity;
                        document.cookie = "cart="+JSON.stringify(cookies)+"; path=/";
                    }
                });
            })
        })

        // const add = document.querySelectorAll('.add');
        // const supp = document.querySelectorAll('supp');
    </script>
{% endblock %}